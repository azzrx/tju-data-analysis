# åˆ†æåŠŸèƒ½ä¸CoTæ€ç»´é“¾å®ç°è¯¦è§£

## ä¸€ã€æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†ç³»ç»Ÿä¸­åˆ†æåŠŸèƒ½çš„å®ç°ï¼Œç‰¹åˆ«æ˜¯å¦‚ä½•é€šè¿‡**å‡½æ•°å®šä¹‰**å’Œ**æ€ç»´é“¾ï¼ˆChain of Thought, CoTï¼‰**æ¥å¼•å¯¼å¤§æ¨¡å‹ä½¿ç”¨æ–°å·¥å…·ï¼Œå®ç°æ™ºèƒ½åˆ†æåŠŸèƒ½ã€‚

### 1.1 æ ¸å¿ƒæ¦‚å¿µ

#### åˆ†æåŠŸèƒ½
åˆ†æåŠŸèƒ½æ˜¯æŒ‡ç³»ç»Ÿèƒ½å¤Ÿè¯†åˆ«ç”¨æˆ·çš„åˆ†ææ„å›¾ï¼Œè°ƒç”¨ç›¸åº”çš„å·¥å…·å‡½æ•°è·å–æ•°æ®ï¼Œç„¶åä½¿ç”¨å¤§æ¨¡å‹å¯¹æ•°æ®è¿›è¡Œæ·±åº¦åˆ†æå’Œè§£é‡Šã€‚

#### æ€ç»´é“¾ï¼ˆCoTï¼‰
æ€ç»´é“¾æ˜¯ä¸€ç§æç¤ºå·¥ç¨‹æŠ€æœ¯ï¼Œé€šè¿‡å¼•å¯¼å¤§æ¨¡å‹æŒ‰ç…§æ­¥éª¤æ€è€ƒï¼Œæé«˜æ¨ç†å’Œåˆ†æçš„å‡†ç¡®æ€§ã€‚åœ¨æœ¬ç³»ç»Ÿä¸­ï¼ŒCoTç”¨äºï¼š
- å¼•å¯¼å¤§æ¨¡å‹ç†è§£å·¥å…·æ‰§è¡Œç»“æœ
- æŒ‰ç…§ç»“æ„åŒ–æ­¥éª¤è¿›è¡Œåˆ†æ
- ç”Ÿæˆä¸“ä¸šã€å‡†ç¡®çš„åˆ†ææŠ¥å‘Š

#### å·¥å…·è°ƒç”¨
ç³»ç»Ÿå®šä¹‰äº†ä¸‰ä¸ªåˆ†æå·¥å…·ï¼š
- **ç½‘ç»œåˆ†æå·¥å…·**ï¼ˆ`network_analysis`ï¼‰ï¼šåˆ†æç½‘ç»œè¿æ¥é—®é¢˜
- **é”™è¯¯åˆ†æå·¥å…·**ï¼ˆ`error_analysis`ï¼‰ï¼šåˆ†æç³»ç»Ÿé”™è¯¯å’Œå¼‚å¸¸
- **æ€§èƒ½åˆ†æå·¥å…·**ï¼ˆ`performance_analysis`ï¼‰ï¼šåˆ†æç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆ

---

## äºŒã€ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ç•Œé¢   â”‚ (Vue.js)
â”‚  Chat.vue   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTP POST /api/chat/stream
       â”‚ {session_id, user_input, query_type}
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åç«¯APIå±‚ (Django)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  api.py                           â”‚  â”‚
â”‚  â”‚  - chat_stream()                  â”‚  â”‚
â”‚  â”‚  - å¤„ç†è¯·æ±‚ã€ä¼šè¯ç®¡ç†              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                           â”‚
â”‚              â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  services.py                      â”‚  â”‚
â”‚  â”‚  - deepseek_r1_api_call_stream()  â”‚  â”‚
â”‚  â”‚  - å·¥å…·è°ƒç”¨ã€LLMè°ƒç”¨               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                           â”‚
â”‚              â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  intent_classifier.py             â”‚  â”‚
â”‚  â”‚  - æ„å›¾åˆ†ç±»                        â”‚  â”‚
â”‚  â”‚  - å·¥å…·æ‰§è¡Œå‡½æ•°                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                           â”‚
â”‚              â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  topklogsystem.py                 â”‚  â”‚
â”‚  â”‚  - RAGæ£€ç´¢ç³»ç»Ÿ                     â”‚  â”‚
â”‚  â”‚  - æ—¥å¿—æ£€ç´¢å’Œåˆ†æ                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å¤§è¯­è¨€æ¨¡å‹ (DeepSeek)            â”‚
â”‚  - å·¥å…·ç»“æœåˆ†æ                          â”‚
â”‚  - CoTæ€ç»´é“¾å¼•å¯¼                         â”‚
â”‚  - ç”Ÿæˆä¸“ä¸šåˆ†ææŠ¥å‘Š                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒç»„ä»¶

1. **æ„å›¾åˆ†ç±»å™¨**ï¼ˆ`intent_classifier.py`ï¼‰
   - è¯†åˆ«ç”¨æˆ·æ„å›¾ç±»å‹
   - åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·
   - æ‰§è¡Œå·¥å…·å‡½æ•°

2. **æœåŠ¡å±‚**ï¼ˆ`services.py`ï¼‰
   - åè°ƒå·¥å…·è°ƒç”¨å’ŒLLMè°ƒç”¨
   - æ„å»ºCoTå¢å¼ºçš„Prompt
   - æµå¼è¿”å›ç»“æœ

3. **å·¥å…·å‡½æ•°**ï¼ˆ`intent_classifier.py`ä¸­çš„å·¥å…·æ–¹æ³•ï¼‰
   - `run_network_analysis()`ï¼šç½‘ç»œåˆ†æå·¥å…·
   - `run_error_analysis()`ï¼šé”™è¯¯åˆ†æå·¥å…·
   - `run_performance_analysis()`ï¼šæ€§èƒ½åˆ†æå·¥å…·

4. **Promptæ¨¡æ¿**ï¼ˆ`prompt_templates.py`ï¼‰
   - å®šä¹‰CoTæ€ç»´é“¾ç»“æ„
   - æä¾›åˆ†ææ­¥éª¤æŒ‡å¯¼

---

## ä¸‰ã€CoTæ€ç»´é“¾è®¾è®¡

### 3.1 CoT Promptç»“æ„

ç³»ç»Ÿä½¿ç”¨ç»“æ„åŒ–çš„CoT Promptæ¥å¼•å¯¼å¤§æ¨¡å‹è¿›è¡Œåˆ†æï¼š

```python
enhanced_prompt = f"""ç”¨æˆ·é—®é¢˜ï¼š{prompt}

å·¥å…·æ‰§è¡Œç»“æœï¼š
{tool_result}

è¯·åŸºäºä»¥ä¸Šå·¥å…·æ‰§è¡Œç»“æœï¼Œå¯¹ç”¨æˆ·çš„é—®é¢˜è¿›è¡Œè¯¦ç»†åˆ†æå’Œå›ç­”ã€‚è¦æ±‚ï¼š
1. å¯¹å·¥å…·ç»“æœè¿›è¡Œæ€»ç»“å’Œåˆ†æ
2. æŒ‡å‡ºå…³é”®é—®é¢˜å’Œå¼‚å¸¸
3. æä¾›å…·ä½“çš„å»ºè®®å’Œè§£å†³æ–¹æ¡ˆ
4. ç”¨æ¸…æ™°ã€ä¸“ä¸šçš„æ–¹å¼ç»„ç»‡å›ç­”"""
```

### 3.2 è¯¦ç»†çš„CoTæ­¥éª¤

å¯¹äºæ—¥å¿—åˆ†æåœºæ™¯ï¼Œç³»ç»Ÿå®šä¹‰äº†æ›´è¯¦ç»†çš„CoTæ­¥éª¤ï¼ˆåœ¨`prompt_templates.py`ä¸­ï¼‰ï¼š

```python
LOG_ANALYSIS_TEMPLATE = """## ç›¸å…³å†å²æ—¥å¿—
{log_context}

## åˆ†æä»»åŠ¡
{query}

## åˆ†æè¦æ±‚
è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œåˆ†æï¼š

### ç¬¬ä¸€æ­¥ï¼šé—®é¢˜è¯†åˆ«
ä»æ—¥å¿—ä¸­æå–å…³é”®é”™è¯¯ä¿¡æ¯ã€å¼‚å¸¸æ¨¡å¼ã€æ€§èƒ½æŒ‡æ ‡

### ç¬¬äºŒæ­¥ï¼šæ ¹å› åˆ†æ
ç»“åˆæ—¥å¿—æ—¶é—´çº¿ã€é”™è¯¯å †æ ˆã€ç³»ç»ŸçŠ¶æ€ï¼Œæ¨æ–­é—®é¢˜æ ¹æœ¬åŸå› 

### ç¬¬ä¸‰æ­¥ï¼šå½±å“è¯„ä¼°
è¯„ä¼°é—®é¢˜çš„ä¸¥é‡ç¨‹åº¦ã€å½±å“èŒƒå›´ã€ä¸šåŠ¡å½±å“

### ç¬¬å››æ­¥ï¼šè§£å†³æ–¹æ¡ˆ
æä¾›åˆ†å±‚è§£å†³æ–¹æ¡ˆï¼š
- ç´§æ€¥ä¿®å¤ï¼ˆç«‹å³å¯æ‰§è¡Œï¼‰
- çŸ­æœŸä¼˜åŒ–ï¼ˆä¸€å‘¨å†…ï¼‰
- é•¿æœŸæ”¹è¿›ï¼ˆæ¶æ„å±‚é¢ï¼‰

### ç¬¬äº”æ­¥ï¼šé¢„é˜²æªæ–½
å»ºè®®ç›‘æ§æŒ‡æ ‡ã€å‘Šè­¦è§„åˆ™ã€ä»£ç è§„èŒƒ
"""
```

### 3.3 CoTçš„ä¼˜åŠ¿

1. **ç»“æ„åŒ–æ€è€ƒ**ï¼šå¼•å¯¼å¤§æ¨¡å‹æŒ‰ç…§æ­¥éª¤æ€è€ƒï¼Œé¿å…é—æ¼å…³é”®ä¿¡æ¯
2. **æé«˜å‡†ç¡®æ€§**ï¼šé€æ­¥åˆ†ææœ‰åŠ©äºæé«˜åˆ†æçš„å‡†ç¡®æ€§
3. **å¯è§£é‡Šæ€§**ï¼šæ¸…æ™°çš„æ­¥éª¤ä½¿å¾—åˆ†æè¿‡ç¨‹å¯è¿½æº¯
4. **ä¸“ä¸šæ€§**ï¼šç»“æ„åŒ–çš„è¾“å‡ºæ›´ç¬¦åˆä¸“ä¸šåˆ†ææŠ¥å‘Šçš„è¦æ±‚

---

## å››ã€å‰åç«¯ä»£ç å®ç°è¯¦è§£

### 4.1 åç«¯ä»£ç å®ç°

#### 4.1.1 æ„å›¾åˆ†ç±»å™¨ï¼ˆ`intent_classifier.py`ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼šè¯†åˆ«ç”¨æˆ·æ„å›¾ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·

```python
class LightweightIntentClassifier:
    """è½»é‡çº§æ„å›¾åˆ†ç±»å™¨ - æ”¯æŒ Ollama å’Œ DeepSeek API"""
    
    def __init__(self, ...):
        # å®šä¹‰å·¥å…·ç±»æ„å›¾ç±»å‹
        self.tools = {
            IntentType.NETWORK_ANALYSIS: self.run_network_analysis,
            IntentType.ERROR_ANALYSIS: self.run_error_analysis,
            IntentType.PERFORMANCE_ANALYSIS: self.run_performance_analysis,
        }
    
    def classify_intent(self, text: str) -> IntentResult:
        """
        åˆ†ç±»ç”¨æˆ·æ„å›¾
        
        æµç¨‹ï¼š
        1. ä½¿ç”¨æ¨¡å‹æˆ–å…³é”®è¯åŒ¹é…è¯†åˆ«æ„å›¾
        2. è¿”å›æ„å›¾ç±»å‹å’Œç½®ä¿¡åº¦
        3. åˆ¤æ–­æ˜¯å¦ä¸ºå·¥å…·ç±»æ„å›¾
        """
        # ä½¿ç”¨æ¨¡å‹è¿›è¡Œæ„å›¾åˆ†ç±»
        intent, confidence = self._classify_with_model(text)
        
        return IntentResult(
            intent=intent,
            confidence=confidence,
            processing_time=processing_time,
            model_used=self.model_name
        )
```

**å·¥å…·æ‰§è¡Œå‡½æ•°**ï¼š

```python
def run_network_analysis(self, query: str) -> str:
    """
    ç½‘ç»œåˆ†æå·¥å…·
    
    åŠŸèƒ½ï¼š
    1. è°ƒç”¨æ—¥å¿—æ£€ç´¢ç³»ç»Ÿ
    2. ä½¿ç”¨å¢å¼ºæŸ¥è¯¢å…³é”®è¯æ£€ç´¢ç½‘ç»œç›¸å…³æ—¥å¿—
    3. è¿”å›æ ¼å¼åŒ–çš„å·¥å…·æ‰§è¡Œç»“æœ
    """
    logger.info(f"ğŸ”§ [å·¥å…·æ‰§è¡Œ] ç½‘ç»œåˆ†æå·¥å…· - æŸ¥è¯¢: {query}")
    try:
        from .services import get_log_system
        system = get_log_system()
        # æ·»åŠ ç½‘ç»œç›¸å…³å…³é”®è¯å¢å¼ºæŸ¥è¯¢
        enhanced_query = f"ç½‘ç»œ è¿æ¥ ç«¯å£ {query}"
        log_results = system.retrieve_logs(enhanced_query, top_k=5)
        
        if log_results:
            result_parts = ["ğŸ“¡ ç½‘ç»œåˆ†æç»“æœï¼š\n"]
            result_parts.append(f"æ£€ç´¢åˆ° {len(log_results)} æ¡ç›¸å…³æ—¥å¿—ï¼š\n")
            for i, log in enumerate(log_results, 1):
                content = log.get('content', '')
                if len(content) > 500:
                    content = content[:500] + "..."
                result_parts.append(f"{i}. {content}")
            return "\n".join(result_parts)
        else:
            return "ğŸ“¡ ç½‘ç»œåˆ†æç»“æœï¼šæœªå‘ç°æ˜æ˜¾çš„ç½‘ç»œè¿æ¥é—®é¢˜ã€‚"
    except Exception as e:
        logger.error(f"ç½‘ç»œåˆ†æå·¥å…·æ‰§è¡Œå¤±è´¥: {e}")
        return f"ğŸ“¡ ç½‘ç»œåˆ†æç»“æœï¼šå·¥å…·æ‰§è¡Œå¼‚å¸¸: {str(e)}"
```

#### 4.1.2 æœåŠ¡å±‚ï¼ˆ`services.py`ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼šåè°ƒå·¥å…·è°ƒç”¨å’ŒLLMè°ƒç”¨ï¼Œæ„å»ºCoTå¢å¼ºçš„Prompt

```python
def deepseek_r1_api_call_stream(prompt: str, query_type: str = "analysis", history_context: str = ""):
    """
    æµå¼è°ƒç”¨ DeepSeek APIï¼ˆæ”¯æŒå·¥å…·è°ƒç”¨å’ŒCoTæ€ç»´é“¾ï¼‰
    
    æµç¨‹ï¼š
    1. æ„å›¾åˆ†ç±»ï¼šè¯†åˆ«ç”¨æˆ·æ„å›¾
    2. å·¥å…·æ‰§è¡Œï¼šå¦‚æœæ˜¯å·¥å…·ç±»æ„å›¾ï¼Œæ‰§è¡Œå·¥å…·å‡½æ•°
    3. CoT Promptæ„å»ºï¼šå°†å·¥å…·ç»“æœæ•´åˆåˆ°CoT Promptä¸­
    4. LLMè°ƒç”¨ï¼šä½¿ç”¨CoT Promptè°ƒç”¨å¤§æ¨¡å‹
    5. æµå¼è¿”å›ï¼šé€æ­¥è¿”å›åˆ†æç»“æœ
    """
    # 1. æ„å›¾åˆ†ç±»
    from .intent_classifier import get_intent_classifier, TOOL_INTENTS
    classifier = get_intent_classifier()
    intent_result = classifier.classify_intent(prompt)
    
    print(f"ğŸ” [æ„å›¾åˆ†ç±»] æ„å›¾: {intent_result.intent.value}, ç½®ä¿¡åº¦: {intent_result.confidence:.3f}")
    
    # 2. å·¥å…·æ‰§è¡Œ
    tool_result = None
    if intent_result.intent in TOOL_INTENTS:
        print(f"ğŸ”§ [å·¥å…·è°ƒç”¨] æ£€æµ‹åˆ°å·¥å…·ç±»æ„å›¾: {intent_result.intent.value}")
        tool_func = classifier.tools.get(intent_result.intent)
        if tool_func:
            tool_result = tool_func(prompt)
            print(f"âœ… [å·¥å…·æ‰§è¡Œ] å·¥å…·æ‰§è¡Œå®Œæˆï¼Œç»“æœé•¿åº¦: {len(tool_result)} å­—ç¬¦")
    
    # 3. CoT Promptæ„å»º
    if tool_result:
        # æ„å»ºåŒ…å«å·¥å…·ç»“æœå’ŒCoTæŒ‡å¯¼çš„Prompt
        enhanced_prompt = f"""ç”¨æˆ·é—®é¢˜ï¼š{prompt}

å·¥å…·æ‰§è¡Œç»“æœï¼š
{tool_result}

è¯·åŸºäºä»¥ä¸Šå·¥å…·æ‰§è¡Œç»“æœï¼Œå¯¹ç”¨æˆ·çš„é—®é¢˜è¿›è¡Œè¯¦ç»†åˆ†æå’Œå›ç­”ã€‚è¦æ±‚ï¼š
1. å¯¹å·¥å…·ç»“æœè¿›è¡Œæ€»ç»“å’Œåˆ†æ
2. æŒ‡å‡ºå…³é”®é—®é¢˜å’Œå¼‚å¸¸
3. æä¾›å…·ä½“çš„å»ºè®®å’Œè§£å†³æ–¹æ¡ˆ
4. ç”¨æ¸…æ™°ã€ä¸“ä¸šçš„æ–¹å¼ç»„ç»‡å›ç­”"""
        
        print(f"ğŸ¤– [å·¥å…·å¢å¼ºPrompt] æ„å»ºå®Œæˆï¼Œé•¿åº¦: {len(enhanced_prompt)} å­—ç¬¦")
        messages.append(ChatMessage(role="user", content=enhanced_prompt))
        
        # 4. LLMè°ƒç”¨
        llm = DeepSeekLLM(model=CURRENT_CONFIG['llm'], timeout=120)
        print(f"ğŸ¤– [æµå¼ç”Ÿæˆ] å¼€å§‹åŸºäºå·¥å…·ç»“æœæµå¼ç”Ÿæˆå›å¤...")
        return llm.stream_chat(messages)
    
    # 5. å¦‚æœä¸æ˜¯å·¥å…·ç±»æ„å›¾ï¼Œä½¿ç”¨å¸¸è§„RAGæµç¨‹
    # ... (RAGæ£€ç´¢å’ŒLLMè°ƒç”¨)
```

#### 4.1.3 APIæ¥å£ï¼ˆ`api.py`ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼šå¤„ç†HTTPè¯·æ±‚ï¼Œè°ƒç”¨æœåŠ¡å±‚å‡½æ•°

```python
@router.post("/chat/stream")
def chat_stream(request, data: ChatIn):
    """
    æµå¼èŠå¤©æ¥å£
    
    æµç¨‹ï¼š
    1. éªŒè¯ç”¨æˆ·èº«ä»½
    2. è·å–ä¼šè¯å†å²
    3. è°ƒç”¨æœåŠ¡å±‚å‡½æ•°è¿›è¡Œå·¥å…·è°ƒç”¨å’ŒLLMè°ƒç”¨
    4. æµå¼è¿”å›ç»“æœ
    5. ä¿å­˜å¯¹è¯å†å²
    """
    # 1. è®¤è¯éªŒè¯
    if not request.auth:
        return StreamingHttpResponse(...)
    
    # 2. è·å–ä¼šè¯
    user = request.auth
    session = get_or_create_session(session_id, user)
    
    def stream_generator():
        """ç”Ÿæˆå™¨å‡½æ•°ï¼šæµå¼è¿”å›"""
        try:
            # 3. è°ƒç”¨æœåŠ¡å±‚å‡½æ•°
            from .services import deepseek_r1_api_call_stream
            
            stream_response = deepseek_r1_api_call_stream(
                user_input, 
                query_type, 
                history_context=session.context
            )
            
            # 4. æµå¼è¿”å›ç»“æœ
            full_reply = ""
            for response in stream_response:
                delta = response.delta if hasattr(response, 'delta') else ""
                if delta:
                    full_reply += delta
                    yield f"data: {json.dumps({'delta': delta, 'content': full_reply})}\n\n"
            
            # 5. ä¿å­˜å¯¹è¯å†å²
            # ... (ä¿å­˜é€»è¾‘)
            
            yield f"data: {json.dumps({'done': True, 'content': full_reply})}\n\n"
        except Exception as e:
            yield f"data: {json.dumps({'error': str(e)})}\n\n"
    
    return StreamingHttpResponse(stream_generator(), content_type='text/event-stream')
```

### 4.2 å‰ç«¯ä»£ç å®ç°

#### 4.2.1 APIè°ƒç”¨ï¼ˆ`api.js`ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼šè°ƒç”¨åç«¯APIï¼Œå¤„ç†æµå¼å“åº”

```javascript
async chatStream(sessionId, userInput, queryType = "general_chat", signal, onMessage, onError, onComplete) {
  const token = localStorage.getItem('apiKey');
  const baseURL = window.location.origin;
  
  try {
    // 1. å‘é€HTTP POSTè¯·æ±‚
    const response = await fetch(`${baseURL}/api/chat/stream`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`,
      },
      body: JSON.stringify({
        session_id: sessionId,
        user_input: userInput,
        query_type: queryType,  // "analysis" æˆ– "general_chat"
      }),
      signal: signal,
    });

    // 2. å¤„ç†æµå¼å“åº”
    const reader = response.body.getReader();
    const decoder = new TextDecoder();
    let buffer = '';

    while (true) {
      const { done, value } = await reader.read();
      if (done) break;

      buffer += decoder.decode(value, { stream: true });
      const lines = buffer.split('\n\n');
      buffer = lines.pop();

      for (const line of lines) {
        if (line.startsWith('data: ')) {
          const data = JSON.parse(line.slice(6));
          
          // 3. å¤„ç†å¢é‡å†…å®¹
          if (data.delta) {
            onMessage(data.delta, data.content);
          }
          
          // 4. å¤„ç†å®Œæˆä¿¡å·
          if (data.done) {
            onComplete(data.content);
          }
          
          // 5. å¤„ç†é”™è¯¯
          if (data.error) {
            onError(data.error);
          }
        }
      }
    }
  } catch (error) {
    onError(error.message);
  }
}
```

#### 4.2.2 èŠå¤©ç•Œé¢ï¼ˆ`Chat.vue`ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼šç”¨æˆ·ç•Œé¢ï¼Œå¤„ç†ç”¨æˆ·è¾“å…¥å’Œæ˜¾ç¤ºå›å¤

```vue
<template>
  <div class="chat-container">
    <!-- èŠå¤©æ¶ˆæ¯åˆ—è¡¨ -->
    <div class="messages-container">
      <ChatMessage
        v-for="msg in messages"
        :key="msg.id"
        :is-user="msg.isUser"
        :content="msg.content"
        :timestamp="msg.timestamp"
      />
    </div>

    <!-- èŠå¤©è¾“å…¥æ¡† -->
    <ChatInput 
      :loading="loading" 
      @send="handleSendMessage" 
      @stop="handleStopGeneration" 
    />
  </div>
</template>

<script>
export default {
  methods: {
    async handleSendMessage(message, queryType = 'analysis') {
      // 1. æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°ç•Œé¢
      this.addMessage(message, true);
      
      // 2. è®¾ç½®åŠ è½½çŠ¶æ€
      this.loading = true;
      this.currentReply = '';
      
      // 3. è°ƒç”¨APIè¿›è¡Œæµå¼èŠå¤©
      await api.chatStream(
        this.currentSession,
        message,
        queryType,
        this.abortController.signal,
        // 4. å¤„ç†å¢é‡æ¶ˆæ¯
        (delta, fullContent) => {
          this.currentReply = fullContent;
          this.updateLastMessage(fullContent);
        },
        // 5. å¤„ç†é”™è¯¯
        (error) => {
          console.error('Chat error:', error);
          this.loading = false;
        },
        // 6. å¤„ç†å®Œæˆ
        (fullContent) => {
          this.loading = false;
          this.addMessage(fullContent, false);
        }
      );
    }
  }
}
</script>
```

#### 4.2.3 èŠå¤©è¾“å…¥ç»„ä»¶ï¼ˆ`ChatInput.vue`ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼šå¤„ç†ç”¨æˆ·è¾“å…¥ï¼Œæ”¯æŒé€‰æ‹©æŸ¥è¯¢ç±»å‹

```vue
<template>
  <div class="chat-input-container">
    <!-- æŸ¥è¯¢ç±»å‹é€‰æ‹© -->
    <div class="query-type-selector">
      <button 
        :class="{ active: queryType === 'analysis' }"
        @click="queryType = 'analysis'"
      >
        æ—¥å¿—åˆ†æ
      </button>
      <button 
        :class="{ active: queryType === 'general_chat' }"
        @click="queryType = 'general_chat'"
      >
        æ—¥å¸¸èŠå¤©
      </button>
    </div>

    <!-- è¾“å…¥æ¡† -->
    <textarea
      v-model="inputText"
      @keydown.enter.prevent="handleSend"
      placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..."
    ></textarea>

    <!-- å‘é€æŒ‰é’® -->
    <button @click="handleSend" :disabled="loading">
      å‘é€
    </button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      inputText: '',
      queryType: 'analysis',  // é»˜è®¤ä½¿ç”¨æ—¥å¿—åˆ†ææ¨¡å¼
    };
  },
  methods: {
    handleSend() {
      if (this.inputText.trim()) {
        // è§¦å‘å‘é€äº‹ä»¶ï¼Œä¼ é€’æ¶ˆæ¯å’ŒæŸ¥è¯¢ç±»å‹
        this.$emit('send', this.inputText.trim(), this.queryType);
        this.inputText = '';
      }
    }
  }
}
</script>
```

---

## äº”ã€å®Œæ•´å·¥ä½œæµç¨‹

### 5.1 ç³»ç»Ÿæ¶æ„æµç¨‹å›¾

```mermaid
graph TB
    A[ç”¨æˆ·åœ¨å‰ç«¯è¾“å…¥é—®é¢˜] --> B[å‰ç«¯å‘é€HTTPè¯·æ±‚]
    B --> C[åç«¯APIå±‚ api.py]
    C --> D[æœåŠ¡å±‚ services.py]
    D --> E[æ„å›¾åˆ†ç±»å™¨ intent_classifier.py]
    E --> F{æ˜¯å¦ä¸ºå·¥å…·ç±»æ„å›¾?}
    F -->|æ˜¯| G[æ‰§è¡Œå·¥å…·å‡½æ•°]
    F -->|å¦| H[å¸¸è§„RAGæµç¨‹]
    G --> I[æ„å»ºCoTå¢å¼ºçš„Prompt]
    H --> J[æ„å»ºRAG Prompt]
    I --> K[è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹ DeepSeek]
    J --> K
    K --> L[å¤§æ¨¡å‹æŒ‰ç…§CoTæ­¥éª¤åˆ†æ]
    L --> M[æµå¼è¿”å›åˆ†æç»“æœ]
    M --> N[å‰ç«¯æ¥æ”¶å¹¶æ˜¾ç¤ºç»“æœ]
    N --> O[ä¿å­˜å¯¹è¯å†å²]
    
    style A fill:#e1f5ff
    style G fill:#fff4e1
    style I fill:#ffe1f5
    style L fill:#e1ffe1
    style M fill:#f5e1ff
```

### 5.2 è¯¦ç»†å·¥ä½œæµç¨‹å›¾

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant F as å‰ç«¯ (Vue.js)
    participant A as APIå±‚ (api.py)
    participant S as æœåŠ¡å±‚ (services.py)
    participant I as æ„å›¾åˆ†ç±»å™¨ (intent_classifier.py)
    participant T as å·¥å…·å‡½æ•°
    participant R as RAGç³»ç»Ÿ
    participant L as å¤§è¯­è¨€æ¨¡å‹ (DeepSeek)
    
    U->>F: è¾“å…¥é—®é¢˜ "åˆ†æç½‘ç»œè¿æ¥é—®é¢˜"
    F->>A: POST /api/chat/stream
    Note over F,A: {session_id, user_input, query_type}
    
    A->>A: éªŒè¯ç”¨æˆ·èº«ä»½
    A->>A: è·å–ä¼šè¯å†å²
    A->>S: è°ƒç”¨ deepseek_r1_api_call_stream()
    
    S->>I: classify_intent("åˆ†æç½‘ç»œè¿æ¥é—®é¢˜")
    I->>I: ä½¿ç”¨æ¨¡å‹æˆ–å…³é”®è¯åŒ¹é…
    I-->>S: è¿”å›: network_analysis, confidence=0.95
    
    S->>S: åˆ¤æ–­: network_analysis in TOOL_INTENTS?
    Note over S: True â†’ è¿›å…¥å·¥å…·æ‰§è¡Œæµç¨‹
    
    S->>T: run_network_analysis("åˆ†æç½‘ç»œè¿æ¥é—®é¢˜")
    T->>R: è°ƒç”¨æ—¥å¿—æ£€ç´¢ç³»ç»Ÿ
    R->>R: æ£€ç´¢ç½‘ç»œç›¸å…³æ—¥å¿— (top_k=5)
    R-->>T: è¿”å›æ—¥å¿—ç»“æœ
    T-->>S: è¿”å›å·¥å…·æ‰§è¡Œç»“æœ
    
    S->>S: æ„å»ºCoTå¢å¼ºçš„Prompt
    Note over S: æ•´åˆç”¨æˆ·é—®é¢˜ã€å·¥å…·ç»“æœã€CoTæ­¥éª¤æŒ‡å¯¼
    
    S->>L: è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹ (CoT Prompt)
    L->>L: ç¬¬ä¸€æ­¥: é—®é¢˜è¯†åˆ«
    L->>L: ç¬¬äºŒæ­¥: æ ¹å› åˆ†æ
    L->>L: ç¬¬ä¸‰æ­¥: å½±å“è¯„ä¼°
    L->>L: ç¬¬å››æ­¥: è§£å†³æ–¹æ¡ˆ
    L->>L: ç¬¬äº”æ­¥: é¢„é˜²æªæ–½
    
    L-->>S: æµå¼è¿”å›åˆ†æç»“æœ (delta)
    S-->>A: æµå¼è¿”å› (SSE)
    A-->>F: æµå¼è¿”å› (SSE)
    F->>F: å®æ—¶æ›´æ–°èŠå¤©ç•Œé¢
    F-->>U: æ˜¾ç¤ºåˆ†æç»“æœ
    
    S->>A: ä¿å­˜å¯¹è¯å†å²
    A->>A: æ›´æ–°ä¼šè¯ä¸Šä¸‹æ–‡
```

### 5.3 CoTæ€ç»´é“¾æ‰§è¡Œæµç¨‹å›¾

```mermaid
graph TD
    A[æ¥æ”¶CoTå¢å¼ºçš„Prompt] --> B[ç¬¬ä¸€æ­¥: é—®é¢˜è¯†åˆ«]
    B --> B1[ä»æ—¥å¿—ä¸­æå–å…³é”®é”™è¯¯ä¿¡æ¯]
    B --> B2[è¯†åˆ«å¼‚å¸¸æ¨¡å¼]
    B --> B3[åˆ†ææ€§èƒ½æŒ‡æ ‡]
    B1 --> C[ç¬¬äºŒæ­¥: æ ¹å› åˆ†æ]
    B2 --> C
    B3 --> C
    
    C --> C1[ç»“åˆæ—¥å¿—æ—¶é—´çº¿]
    C --> C2[åˆ†æé”™è¯¯å †æ ˆ]
    C --> C3[æ¨æ–­ç³»ç»ŸçŠ¶æ€]
    C1 --> D[ç¬¬ä¸‰æ­¥: å½±å“è¯„ä¼°]
    C2 --> D
    C3 --> D
    
    D --> D1[è¯„ä¼°é—®é¢˜ä¸¥é‡ç¨‹åº¦]
    D --> D2[åˆ†æå½±å“èŒƒå›´]
    D --> D3[è¯„ä¼°ä¸šåŠ¡å½±å“]
    D1 --> E[ç¬¬å››æ­¥: è§£å†³æ–¹æ¡ˆ]
    D2 --> E
    D3 --> E
    
    E --> E1[ç´§æ€¥ä¿®å¤å»ºè®®]
    E --> E2[çŸ­æœŸä¼˜åŒ–æ–¹æ¡ˆ]
    E --> E3[é•¿æœŸæ”¹è¿›å»ºè®®]
    E1 --> F[ç¬¬äº”æ­¥: é¢„é˜²æªæ–½]
    E2 --> F
    E3 --> F
    
    F --> F1[ç›‘æ§æŒ‡æ ‡å»ºè®®]
    F --> F2[å‘Šè­¦è§„åˆ™å»ºè®®]
    F --> F3[ä»£ç è§„èŒƒå»ºè®®]
    F1 --> G[ç”Ÿæˆæœ€ç»ˆåˆ†ææŠ¥å‘Š]
    F2 --> G
    F3 --> G
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#ffe1f5
    style D fill:#e1ffe1
    style E fill:#f5e1ff
    style F fill:#ffe1e1
    style G fill:#e1e1ff
```

### 5.4 å·¥å…·è°ƒç”¨æµç¨‹å›¾

```mermaid
graph LR
    A[ç”¨æˆ·è¾“å…¥] --> B[æ„å›¾åˆ†ç±»]
    B --> C{å·¥å…·ç±»æ„å›¾?}
    C -->|network_analysis| D[ç½‘ç»œåˆ†æå·¥å…·]
    C -->|error_analysis| E[é”™è¯¯åˆ†æå·¥å…·]
    C -->|performance_analysis| F[æ€§èƒ½åˆ†æå·¥å…·]
    C -->|å…¶ä»–| G[å¸¸è§„RAGæµç¨‹]
    
    D --> D1[å¢å¼ºæŸ¥è¯¢: ç½‘ç»œ è¿æ¥ ç«¯å£]
    E --> E1[å¢å¼ºæŸ¥è¯¢: é”™è¯¯ å¼‚å¸¸ error]
    F --> F1[å¢å¼ºæŸ¥è¯¢: æ€§èƒ½ cpu å†…å­˜]
    
    D1 --> H[æ—¥å¿—æ£€ç´¢ç³»ç»Ÿ]
    E1 --> H
    F1 --> H
    
    H --> I[æ£€ç´¢ç›¸å…³æ—¥å¿— top_k=5]
    I --> J[æ ¼å¼åŒ–å·¥å…·ç»“æœ]
    J --> K[è¿”å›å·¥å…·æ‰§è¡Œç»“æœ]
    K --> L[æ„å»ºCoT Prompt]
    L --> M[è°ƒç”¨å¤§æ¨¡å‹]
    
    G --> M
    
    style D fill:#fff4e1
    style E fill:#ffe1f5
    style F fill:#e1ffe1
    style H fill:#e1f5ff
    style L fill:#f5e1ff
    style M fill:#ffe1e1
```

### 5.5 æ•°æ®æµå›¾

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚"
        A1[ç”¨æˆ·è¾“å…¥]
        A2[ChatInputç»„ä»¶]
        A3[Chat.vueç•Œé¢]
        A4[APIè°ƒç”¨ api.js]
    end
    
    subgraph "åç«¯APIå±‚"
        B1[chat_streamæ¥å£]
        B2[ä¼šè¯ç®¡ç†]
        B3[è¯·æ±‚éªŒè¯]
    end
    
    subgraph "æœåŠ¡å±‚"
        C1[deepseek_r1_api_call_stream]
        C2[æ„å›¾åˆ†ç±»è°ƒç”¨]
        C3[å·¥å…·æ‰§è¡Œè°ƒç”¨]
        C4[CoT Promptæ„å»º]
        C5[LLMè°ƒç”¨]
    end
    
    subgraph "å·¥å…·å±‚"
        D1[æ„å›¾åˆ†ç±»å™¨]
        D2[ç½‘ç»œåˆ†æå·¥å…·]
        D3[é”™è¯¯åˆ†æå·¥å…·]
        D4[æ€§èƒ½åˆ†æå·¥å…·]
    end
    
    subgraph "æ•°æ®å±‚"
        E1[RAGæ£€ç´¢ç³»ç»Ÿ]
        E2[æ—¥å¿—æ•°æ®åº“]
        E3[ä¼šè¯æ•°æ®åº“]
    end
    
    subgraph "æ¨¡å‹å±‚"
        F1[DeepSeek LLM]
        F2[CoTåˆ†æ]
        F3[æµå¼ç”Ÿæˆ]
    end
    
    A1 --> A2
    A2 --> A3
    A3 --> A4
    A4 --> B1
    B1 --> B2
    B1 --> B3
    B1 --> C1
    C1 --> C2
    C2 --> D1
    D1 --> C3
    C3 --> D2
    C3 --> D3
    C3 --> D4
    D2 --> E1
    D3 --> E1
    D4 --> E1
    E1 --> E2
    C3 --> C4
    C4 --> C5
    C5 --> F1
    F1 --> F2
    F2 --> F3
    F3 --> C5
    C5 --> C1
    C1 --> B1
    B1 --> A4
    A4 --> A3
    B2 --> E3
    
    style A1 fill:#e1f5ff
    style C4 fill:#fff4e1
    style F2 fill:#ffe1f5
    style E1 fill:#e1ffe1
```

### 5.6 æ–‡æœ¬æµç¨‹å›¾ï¼ˆASCII Artï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·åœ¨å‰ç«¯è¾“å…¥é—®é¢˜                         â”‚
â”‚                    "åˆ†æç½‘ç»œè¿æ¥é—®é¢˜"                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å‰ç«¯å‘é€HTTPè¯·æ±‚                            â”‚
â”‚  POST /api/chat/stream                                          â”‚
â”‚  {                                                               â”‚
â”‚    session_id: "session_123",                                   â”‚
â”‚    user_input: "åˆ†æç½‘ç»œè¿æ¥é—®é¢˜",                              â”‚
â”‚    query_type: "analysis"                                       â”‚
â”‚  }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åç«¯APIå±‚ï¼ˆapi.pyï¼‰                            â”‚
â”‚  - éªŒè¯ç”¨æˆ·èº«ä»½                                                  â”‚
â”‚  - è·å–ä¼šè¯å†å²                                                  â”‚
â”‚  - è°ƒç”¨æœåŠ¡å±‚å‡½æ•°                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æœåŠ¡å±‚ï¼ˆservices.pyï¼‰                            â”‚
â”‚  deepseek_r1_api_call_stream()                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               æ„å›¾åˆ†ç±»å™¨ï¼ˆintent_classifier.pyï¼‰                 â”‚
â”‚  - classify_intent("åˆ†æç½‘ç»œè¿æ¥é—®é¢˜")                          â”‚
â”‚  - è¿”å›: IntentType.NETWORK_ANALYSIS, confidence=0.95           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åˆ¤æ–­æ˜¯å¦ä¸ºå·¥å…·ç±»æ„å›¾                            â”‚
â”‚  network_analysis in TOOL_INTENTS? â†’ True                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ‰§è¡Œå·¥å…·å‡½æ•°                                    â”‚
â”‚  run_network_analysis("åˆ†æç½‘ç»œè¿æ¥é—®é¢˜")                        â”‚
â”‚  - è°ƒç”¨æ—¥å¿—æ£€ç´¢ç³»ç»Ÿ                                              â”‚
â”‚  - æ£€ç´¢ç½‘ç»œç›¸å…³æ—¥å¿—ï¼ˆtop_k=5ï¼‰                                  â”‚
â”‚  - è¿”å›å·¥å…·æ‰§è¡Œç»“æœ                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ„å»ºCoTå¢å¼ºçš„Prompt                            â”‚
â”‚  enhanced_prompt = """                                           â”‚
â”‚  ç”¨æˆ·é—®é¢˜ï¼šåˆ†æç½‘ç»œè¿æ¥é—®é¢˜                                       â”‚
â”‚                                                                  â”‚
â”‚  å·¥å…·æ‰§è¡Œç»“æœï¼š                                                  â”‚
â”‚  ğŸ“¡ ç½‘ç»œåˆ†æç»“æœï¼š                                               â”‚
â”‚  æ£€ç´¢åˆ° 5 æ¡ç›¸å…³æ—¥å¿—ï¼š                                           â”‚
â”‚  1. [æ—¥å¿—å†…å®¹1]                                                 â”‚
â”‚  2. [æ—¥å¿—å†…å®¹2]                                                 â”‚
â”‚  ...                                                             â”‚
â”‚                                                                  â”‚
â”‚  è¯·åŸºäºä»¥ä¸Šå·¥å…·æ‰§è¡Œç»“æœï¼Œå¯¹ç”¨æˆ·çš„é—®é¢˜è¿›è¡Œè¯¦ç»†åˆ†æå’Œå›ç­”ã€‚è¦æ±‚ï¼š  â”‚
â”‚  1. å¯¹å·¥å…·ç»“æœè¿›è¡Œæ€»ç»“å’Œåˆ†æ                                     â”‚
â”‚  2. æŒ‡å‡ºå…³é”®é—®é¢˜å’Œå¼‚å¸¸                                           â”‚
â”‚  3. æä¾›å…·ä½“çš„å»ºè®®å’Œè§£å†³æ–¹æ¡ˆ                                     â”‚
â”‚  4. ç”¨æ¸…æ™°ã€ä¸“ä¸šçš„æ–¹å¼ç»„ç»‡å›ç­”                                   â”‚
â”‚  """                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆDeepSeekï¼‰                      â”‚
â”‚  - è¾“å…¥: CoTå¢å¼ºçš„Prompt                                        â”‚
â”‚  - æ¨¡å‹: deepseek-chat                                          â”‚
â”‚  - æ¨¡å¼: æµå¼ç”Ÿæˆ                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å¤§æ¨¡å‹æŒ‰ç…§CoTæ­¥éª¤åˆ†æ                            â”‚
â”‚  ç¬¬ä¸€æ­¥ï¼šé—®é¢˜è¯†åˆ«                                                â”‚
â”‚    - ä»æ—¥å¿—ä¸­æå–å…³é”®é”™è¯¯ä¿¡æ¯                                    â”‚
â”‚    - è¯†åˆ«å¼‚å¸¸æ¨¡å¼                                                â”‚
â”‚                                                                  â”‚
â”‚  ç¬¬äºŒæ­¥ï¼šæ ¹å› åˆ†æ                                                â”‚
â”‚    - ç»“åˆæ—¥å¿—æ—¶é—´çº¿æ¨æ–­æ ¹æœ¬åŸå›                                   â”‚
â”‚                                                                  â”‚
â”‚  ç¬¬ä¸‰æ­¥ï¼šå½±å“è¯„ä¼°                                                â”‚
â”‚    - è¯„ä¼°é—®é¢˜çš„ä¸¥é‡ç¨‹åº¦                                          â”‚
â”‚                                                                  â”‚
â”‚  ç¬¬å››æ­¥ï¼šè§£å†³æ–¹æ¡ˆ                                                â”‚
â”‚    - ç´§æ€¥ä¿®å¤å»ºè®®                                                â”‚
â”‚    - çŸ­æœŸä¼˜åŒ–æ–¹æ¡ˆ                                                â”‚
â”‚    - é•¿æœŸæ”¹è¿›å»ºè®®                                                â”‚
â”‚                                                                  â”‚
â”‚  ç¬¬äº”æ­¥ï¼šé¢„é˜²æªæ–½                                                â”‚
â”‚    - ç›‘æ§æŒ‡æ ‡å»ºè®®                                                â”‚
â”‚    - å‘Šè­¦è§„åˆ™å»ºè®®                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æµå¼è¿”å›åˆ†æç»“æœ                                â”‚
â”‚  - é€æ­¥ç”Ÿæˆåˆ†æå†…å®¹                                              â”‚
â”‚  - å®æ—¶è¿”å›ç»™å‰ç«¯                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å‰ç«¯æ¥æ”¶å¹¶æ˜¾ç¤ºç»“æœ                              â”‚
â”‚  - å®æ—¶æ›´æ–°èŠå¤©ç•Œé¢                                              â”‚
â”‚  - æ˜¾ç¤ºå®Œæ•´çš„åˆ†ææŠ¥å‘Š                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¿å­˜å¯¹è¯å†å²                                    â”‚
â”‚  - å°†ç”¨æˆ·è¾“å…¥å’Œåˆ†æç»“æœä¿å­˜åˆ°ä¼šè¯å†å²                            â”‚
â”‚  - ç”¨äºåç»­å¤šè½®å¯¹è¯                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 è¯¦ç»†æ­¥éª¤è¯´æ˜

#### æ­¥éª¤1ï¼šç”¨æˆ·è¾“å…¥
- ç”¨æˆ·åœ¨å‰ç«¯è¾“å…¥é—®é¢˜ï¼Œä¾‹å¦‚"åˆ†æç½‘ç»œè¿æ¥é—®é¢˜"
- é€‰æ‹©æŸ¥è¯¢ç±»å‹ï¼ˆanalysis æˆ– general_chatï¼‰

#### æ­¥éª¤2ï¼šæ„å›¾åˆ†ç±»
- åç«¯ä½¿ç”¨æ„å›¾åˆ†ç±»å™¨è¯†åˆ«ç”¨æˆ·æ„å›¾
- åˆ¤æ–­æ˜¯å¦ä¸ºå·¥å…·ç±»æ„å›¾ï¼ˆnetwork_analysis, error_analysis, performance_analysisï¼‰

#### æ­¥éª¤3ï¼šå·¥å…·æ‰§è¡Œ
- å¦‚æœæ˜¯å·¥å…·ç±»æ„å›¾ï¼Œæ‰§è¡Œå¯¹åº”çš„å·¥å…·å‡½æ•°
- å·¥å…·å‡½æ•°è°ƒç”¨æ—¥å¿—æ£€ç´¢ç³»ç»Ÿï¼Œè·å–ç›¸å…³æ—¥å¿—
- è¿”å›æ ¼å¼åŒ–çš„å·¥å…·æ‰§è¡Œç»“æœ

#### æ­¥éª¤4ï¼šCoT Promptæ„å»º
- å°†ç”¨æˆ·é—®é¢˜ã€å·¥å…·æ‰§è¡Œç»“æœæ•´åˆåˆ°CoT Promptä¸­
- æ·»åŠ åˆ†ææ­¥éª¤æŒ‡å¯¼ï¼ˆé—®é¢˜è¯†åˆ«ã€æ ¹å› åˆ†æã€å½±å“è¯„ä¼°ã€è§£å†³æ–¹æ¡ˆã€é¢„é˜²æªæ–½ï¼‰

#### æ­¥éª¤5ï¼šLLMè°ƒç”¨
- ä½¿ç”¨CoT Promptè°ƒç”¨å¤§è¯­è¨€æ¨¡å‹
- æ¨¡å‹æŒ‰ç…§CoTæ­¥éª¤è¿›è¡Œåˆ†æ
- æµå¼ç”Ÿæˆåˆ†æç»“æœ

#### æ­¥éª¤6ï¼šç»“æœè¿”å›
- é€æ­¥è¿”å›åˆ†æç»“æœç»™å‰ç«¯
- å‰ç«¯å®æ—¶æ›´æ–°èŠå¤©ç•Œé¢
- æ˜¾ç¤ºå®Œæ•´çš„åˆ†ææŠ¥å‘Š

#### æ­¥éª¤7ï¼šå†å²ä¿å­˜
- å°†ç”¨æˆ·è¾“å…¥å’Œåˆ†æç»“æœä¿å­˜åˆ°ä¼šè¯å†å²
- ç”¨äºåç»­å¤šè½®å¯¹è¯å’Œä¸Šä¸‹æ–‡ç†è§£

---

## å…­ã€ä»£ç æ–‡ä»¶ä½ç½®

### 6.1 åç«¯ä»£ç 

1. **æ„å›¾åˆ†ç±»å™¨**ï¼š`django_backend/deepseek_api/intent_classifier.py`
   - `LightweightIntentClassifier`ç±»ï¼šæ„å›¾åˆ†ç±»å’Œå·¥å…·æ‰§è¡Œ
   - `run_network_analysis()`ï¼šç½‘ç»œåˆ†æå·¥å…·
   - `run_error_analysis()`ï¼šé”™è¯¯åˆ†æå·¥å…·
   - `run_performance_analysis()`ï¼šæ€§èƒ½åˆ†æå·¥å…·

2. **æœåŠ¡å±‚**ï¼š`django_backend/deepseek_api/services.py`
   - `deepseek_r1_api_call()`ï¼šéæµå¼APIè°ƒç”¨
   - `deepseek_r1_api_call_stream()`ï¼šæµå¼APIè°ƒç”¨ï¼ˆæ”¯æŒå·¥å…·è°ƒç”¨å’ŒCoTï¼‰

3. **APIæ¥å£**ï¼š`django_backend/deepseek_api/api.py`
   - `chat_stream()`ï¼šæµå¼èŠå¤©æ¥å£
   - å¤„ç†HTTPè¯·æ±‚å’Œå“åº”

4. **Promptæ¨¡æ¿**ï¼š`django_backend/deepseek_api/prompt_templates.py`
   - `PromptTemplates`ç±»ï¼šå®šä¹‰CoT Promptæ¨¡æ¿
   - `LOG_ANALYSIS_TEMPLATE`ï¼šæ—¥å¿—åˆ†æçš„CoTæ¨¡æ¿

### 6.2 å‰ç«¯ä»£ç 

1. **APIè°ƒç”¨**ï¼š`vue_frontend/src/api.js`
   - `chatStream()`ï¼šè°ƒç”¨åç«¯æµå¼API
   - å¤„ç†æµå¼å“åº”

2. **èŠå¤©ç•Œé¢**ï¼š`vue_frontend/src/views/Chat.vue`
   - `handleSendMessage()`ï¼šå¤„ç†ç”¨æˆ·å‘é€æ¶ˆæ¯
   - æ˜¾ç¤ºèŠå¤©æ¶ˆæ¯å’ŒåŠ è½½çŠ¶æ€

3. **èŠå¤©è¾“å…¥**ï¼š`vue_frontend/src/components/ChatInput.vue`
   - å¤„ç†ç”¨æˆ·è¾“å…¥
   - æ”¯æŒé€‰æ‹©æŸ¥è¯¢ç±»å‹

---

## ä¸ƒã€CoTæ€ç»´é“¾çš„ä¼˜åŒ–å»ºè®®

### 7.1 å½“å‰å®ç°çš„ä¼˜åŠ¿

1. **ç»“æ„åŒ–åˆ†æ**ï¼šé€šè¿‡æ˜ç¡®çš„æ­¥éª¤å¼•å¯¼å¤§æ¨¡å‹è¿›è¡Œåˆ†æ
2. **å·¥å…·é›†æˆ**ï¼šå·¥å…·æ‰§è¡Œç»“æœç›´æ¥æ•´åˆåˆ°CoT Promptä¸­
3. **æµå¼è¾“å‡º**ï¼šæ”¯æŒå®æ—¶è¿”å›åˆ†æç»“æœ
4. **å¯æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°çš„åˆ†æå·¥å…·å’ŒCoTæ­¥éª¤

### 7.2 æ”¹è¿›æ–¹å‘

1. **åŠ¨æ€CoTæ­¥éª¤**ï¼šæ ¹æ®é—®é¢˜ç±»å‹åŠ¨æ€è°ƒæ•´CoTæ­¥éª¤
2. **å¤šè½®å¯¹è¯CoT**ï¼šåœ¨å¤šè½®å¯¹è¯ä¸­ä¿æŒCoTä¸Šä¸‹æ–‡
3. **å·¥å…·é“¾è°ƒç”¨**ï¼šæ”¯æŒå¤šä¸ªå·¥å…·é“¾å¼è°ƒç”¨
4. **CoTç»“æœéªŒè¯**ï¼šå¯¹CoTåˆ†æç»“æœè¿›è¡ŒéªŒè¯å’Œä¼˜åŒ–

### 7.3 ç¤ºä¾‹ï¼šå¢å¼ºçš„CoT Prompt

```python
def build_enhanced_cot_prompt(user_query: str, tool_result: str, context: dict) -> str:
    """
    æ„å»ºå¢å¼ºçš„CoT Prompt
    
    ç‰¹ç‚¹ï¼š
    1. æ ¹æ®é—®é¢˜ç±»å‹åŠ¨æ€è°ƒæ•´æ­¥éª¤
    2. åŒ…å«å†å²ä¸Šä¸‹æ–‡
    3. æä¾›æ›´è¯¦ç»†çš„åˆ†ææŒ‡å¯¼
    """
    # æ ¹æ®é—®é¢˜ç±»å‹é€‰æ‹©CoTæ¨¡æ¿
    if "ç½‘ç»œ" in user_query or "è¿æ¥" in user_query:
        cot_steps = """
        ### ç¬¬ä¸€æ­¥ï¼šç½‘ç»œè¿æ¥é—®é¢˜è¯†åˆ«
        - æ£€æŸ¥è¿æ¥è¶…æ—¶ã€æ‹’ç»è¿æ¥ç­‰é”™è¯¯
        - åˆ†æç«¯å£çŠ¶æ€å’Œé˜²ç«å¢™è§„åˆ™
        - è¯†åˆ«DNSè§£æé—®é¢˜
        
        ### ç¬¬äºŒæ­¥ï¼šç½‘ç»œæ‹“æ‰‘åˆ†æ
        - åˆ†ææœåŠ¡é—´é€šä¿¡è·¯å¾„
        - æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿå’Œå¸¦å®½
        - è¯†åˆ«ç½‘ç»œç“¶é¢ˆ
        
        ### ç¬¬ä¸‰æ­¥ï¼šæ ¹å› å®šä½
        - ç»“åˆæ—¥å¿—æ—¶é—´çº¿å®šä½é—®é¢˜å‘ç”Ÿæ—¶é—´
        - åˆ†æé”™è¯¯å †æ ˆå’Œå¼‚å¸¸ä¿¡æ¯
        - æ¨æ–­æ ¹æœ¬åŸå› 
        
        ### ç¬¬å››æ­¥ï¼šè§£å†³æ–¹æ¡ˆ
        - ç´§æ€¥ä¿®å¤ï¼šé‡å¯æœåŠ¡ã€è°ƒæ•´é…ç½®
        - çŸ­æœŸä¼˜åŒ–ï¼šä¼˜åŒ–ç½‘ç»œé…ç½®ã€å¢åŠ ç›‘æ§
        - é•¿æœŸæ”¹è¿›ï¼šæ¶æ„ä¼˜åŒ–ã€å®¹é”™è®¾è®¡
        
        ### ç¬¬äº”æ­¥ï¼šé¢„é˜²æªæ–½
        - è®¾ç½®ç½‘ç»œç›‘æ§å‘Šè­¦
        - å»ºç«‹ç½‘ç»œå¥åº·æ£€æŸ¥æœºåˆ¶
        - åˆ¶å®šç½‘ç»œæ•…éšœåº”æ€¥é¢„æ¡ˆ
        """
    else:
        # ä½¿ç”¨é€šç”¨çš„CoTæ­¥éª¤
        cot_steps = """
        ### ç¬¬ä¸€æ­¥ï¼šé—®é¢˜è¯†åˆ«
        ### ç¬¬äºŒæ­¥ï¼šæ ¹å› åˆ†æ
        ### ç¬¬ä¸‰æ­¥ï¼šå½±å“è¯„ä¼°
        ### ç¬¬å››æ­¥ï¼šè§£å†³æ–¹æ¡ˆ
        ### ç¬¬äº”æ­¥ï¼šé¢„é˜²æªæ–½
        """
    
    prompt = f"""ç”¨æˆ·é—®é¢˜ï¼š{user_query}

å·¥å…·æ‰§è¡Œç»“æœï¼š
{tool_result}

å†å²ä¸Šä¸‹æ–‡ï¼š
{context.get('history', 'æ— ')}

è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œåˆ†æï¼š
{cot_steps}

è¯·å¼€å§‹åˆ†æï¼š"""
    
    return prompt
```

---

## å…«ã€æ€»ç»“

### 8.1 æ ¸å¿ƒè¦ç‚¹

1. **åˆ†æåŠŸèƒ½**ï¼šé€šè¿‡æ„å›¾åˆ†ç±»è¯†åˆ«åˆ†æéœ€æ±‚ï¼Œè°ƒç”¨å·¥å…·å‡½æ•°è·å–æ•°æ®ï¼Œä½¿ç”¨å¤§æ¨¡å‹è¿›è¡Œæ·±åº¦åˆ†æ

2. **CoTæ€ç»´é“¾**ï¼šé€šè¿‡ç»“æ„åŒ–çš„Promptå¼•å¯¼å¤§æ¨¡å‹æŒ‰ç…§æ­¥éª¤æ€è€ƒï¼Œæé«˜åˆ†æçš„å‡†ç¡®æ€§å’Œä¸“ä¸šæ€§

3. **å·¥å…·è°ƒç”¨**ï¼šå®šä¹‰äº†ä¸‰ä¸ªåˆ†æå·¥å…·ï¼ˆç½‘ç»œåˆ†æã€é”™è¯¯åˆ†æã€æ€§èƒ½åˆ†æï¼‰ï¼Œé€šè¿‡å·¥å…·æ‰§è¡Œè·å–åŸå§‹æ•°æ®

4. **æµå¼è¾“å‡º**ï¼šæ”¯æŒå®æ—¶è¿”å›åˆ†æç»“æœï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

### 8.2 æŠ€æœ¯äº®ç‚¹

1. **æ„å›¾é©±åŠ¨**ï¼šé€šè¿‡æ„å›¾åˆ†ç±»è‡ªåŠ¨è¯†åˆ«åˆ†æéœ€æ±‚ï¼Œæ— éœ€ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©å·¥å…·
2. **å·¥å…·å¢å¼º**ï¼šå·¥å…·æ‰§è¡Œç»“æœç›´æ¥æ•´åˆåˆ°CoT Promptä¸­ï¼Œæä¾›æ•°æ®æ”¯æŒ
3. **ç»“æ„åŒ–åˆ†æ**ï¼šé€šè¿‡CoTæ­¥éª¤å¼•å¯¼å¤§æ¨¡å‹è¿›è¡Œç»“æ„åŒ–åˆ†æ
4. **å¯æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°çš„åˆ†æå·¥å…·å’ŒCoTæ­¥éª¤

### 8.3 åº”ç”¨åœºæ™¯

1. **æ—¥å¿—åˆ†æ**ï¼šåˆ†æç³»ç»Ÿæ—¥å¿—ï¼Œè¯†åˆ«é”™è¯¯å’Œå¼‚å¸¸
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆ†æç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆï¼Œæä¾›ä¼˜åŒ–å»ºè®®
3. **æ•…éšœæ’æŸ¥**ï¼šå¿«é€Ÿå®šä½ç³»ç»Ÿæ•…éšœçš„æ ¹æœ¬åŸå› 
4. **è¿ç»´ç›‘æ§**ï¼šæä¾›ç³»ç»Ÿå¥åº·çŠ¶æ€åˆ†æå’Œé¢„è­¦

---

## ä¹ã€å‚è€ƒæ–‡æ¡£

1. **å·¥ä½œæµè¯´æ˜**ï¼š`django_backend/å·¥ä½œæµè¯´æ˜.md`
2. **RAGæ¶æ„å®ç°**ï¼š`RAGæ¶æ„å®ç°è¯¦è§£.md`
3. **Promptè®¾è®¡å®ç°**ï¼š`Promptè®¾è®¡å®ç°è¯¦è§£.md`
4. **å¤šè½®å¯¹è¯åŠŸèƒ½**ï¼š`å¤šè½®å¯¹è¯åŠŸèƒ½å®ç°è¯¦è§£.md`

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0  
**æœ€åæ›´æ–°**ï¼š2025å¹´  
**ä½œè€…**ï¼šç³»ç»Ÿå¼€å‘å›¢é˜Ÿ

